import queue
import sys
import subprocess
from threading import Thread

number = int(sys.argv[1])

HortQueue = queue.Queue()
with open('ip.txt') as content:
    for cent in content:
        HortQueue.put(cent.strip())

def main():
    while not HortQueue.empty():
        host = HortQueue.get().split(':')
        ip,port = host[0],host[1]
        print(ip,port)
        environment = '0708detector.exe -t {} -p {}'
        status = subprocess.getstatusoutput(environment.format(ip,port))
        if 'VULNERABLE' in status[1]:
            print(ip,'WARNING: SERVER IS VULNERABLE!')
        else:
            print(ip,'TIPS: SERVER IS NOT VULNERABLE!')


for i in range(number):
    thread = Thread(target=main)
    thread.start()